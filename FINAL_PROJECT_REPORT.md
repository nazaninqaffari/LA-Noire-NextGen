# گزارش نهایی پروژه — سیستم مدیریت جرم LA Noire NextGen

---

## فهرست مطالب

1. [مقدمه و معرفی کلی سیستم](#1-مقدمه-و-معرفی-کلی-سیستم)

2. [تحلیل نیازمندی‌ها و تصمیمات طراحی](#2-تحلیل-نیازمندیها-و-تصمیمات-طراحی)

3. [معماری کلی سیستم](#3-معماری-کلی-سیستم)

4. [موجودیت‌ها و دلیل وجودشان](#4-موجودیتها-و-دلیل-وجودشان)

5. [پیاده‌سازی جریان‌های کاری](#5-پیادهسازی-جریانهای-کاری)

6. [کنترل دسترسی و مدیریت نقش‌ها](#6-کنترل-دسترسی-و-مدیریت-نقشها)

7. [طراحی API و اصول REST](#7-طراحی-api-و-اصول-rest)

8. [ساختار فرانت‌اند و صفحات اصلی](#8-ساختار-فرانتاند-و-صفحات-اصلی)

9. [داکرایز و ساختار استقرار](#9-داکرایز-و-ساختار-استقرار)

10. [تست‌نویسی](#10-تستنویسی)

11. [نقاط قوت و ضعف تصمیمات](#11-نقاط-قوت-و-ضعف-تصمیمات)

12. [استفاده از هوش مصنوعی](#12-استفاده-از-هوش-مصنوعی)

13. [مدیریت پروژه و تقسیم کار](#13-مدیریت-پروژه-و-تقسیم-کار)

---

## 1. مقدمه و معرفی کلی سیستم

پروژه LA Noire NextGen یک سیستم وب‌محور مدیریت پرونده‌های جنایی است که با الهام از بازی LA Noire طراحی شده. این سیستم تمام مراحل یک پرونده جنایی رو از ثبت شکایت اولیه تا صدور حکم دادگاه پوشش می‌ده و برای نقش‌های مختلفی مثل شهروندان، کارآگاهان، افسران، قاضی و مدیر سیستم طراحی شده.

هدف اصلی پروژه شبیه‌سازی یک سیستم واقعی مدیریت جرم و جنایت بود که در اون:

- شهروندان بتونن شکایت ثبت کنن یا اطلاعات جرم ارسال کنن

- افسران پرونده‌ها رو بررسی و باز کنن

- کارآگاهان تحقیق کنن، مدارک جمع کنن و مظنون‌ها رو شناسایی کنن

- بازجویی انجام بشه و تصمیم‌گیری بشه

- محاکمه و صدور حکم انجام بشه

- سیستم پاداش و وثیقه با درگاه پرداخت واقعی (زرین‌پال) کار کنه

تکنولوژی‌های اصلی:

- **بک‌اند**: Django 4.2 + Django REST Framework + PostgreSQL

- **فرانت‌اند**: React 18 + TypeScript + Vite

- **استقرار**: Docker Compose (سه سرویس: db, backend, frontend)

- **پرداخت**: درگاه زرین‌پال (حالت Sandbox)

---

## 2. تحلیل نیازمندی‌ها و تصمیمات طراحی

### 2.1 نیازمندی‌های اولیه

وقتی پروژه شروع شد، نیازمندی‌های اصلی اینا بودن:

- سیستم ثبت و مدیریت پرونده‌های جنایی

- سیستم مدیریت مدارک

- سیستم نقش‌محور با سلسله‌مراتب پلیسی

- جریان کاری از ثبت شکایت تا بسته شدن پرونده

- پنل مدیریت

### 2.2 نیازمندی‌هایی که بعداً اضافه شدن

در طول توسعه، ماژول‌های زیر هم به پروژه اضافه شدن:

- **تخته کارآگاهی** (Detective Board): یه بوم بصری برای کارآگاه که مدارک رو روش بذاره و بینشون خط قرمز بکشه

- **سیستم بازجویی**: با امتیازدهی ۱ تا ۱۰ توسط کارآگاه و گروهبان

- **سیستم تصمیم‌گیری چندسطحی**: کاپیتان → رئیس پلیس (برای جرایم حیاتی)

- **سیستم محاکمه**: ایجاد دادگاه، رأی قاضی، صدور مجازات

- **سیستم وثیقه با پرداخت زرین‌پال**: پرداخت آنلاین وثیقه و آزادی مظنون

- **سیستم پاداش و خبرچینی** (TipOff): شهروندان اطلاعات ارسال می‌کنن، بررسی می‌شه، کد پاداش صادر می‌شه

- **لیست تحت تعقیب عمومی** (Most Wanted): مظنونین بالای ۳۰ روز با امتیاز خطر

- **سیستم نوتیفیکیشن**: اعلان‌های درون‌برنامه‌ای برای تغییرات پرونده

### 2.3 تصمیمات طراحی مهم

**Session-based Authentication به جای JWT:** از احراز هویت مبتنی بر Session و Cookie استفاده کردیم. دلیلش این بود که فرانت‌اند و بک‌اند روی یک دامنه سرو می‌شن (از طریق nginx proxy) و نیازی به JWT نبود. این کار هم ساده‌تره و هم امنیت CSRF رو راحت‌تر مدیریت می‌کنه.

**نقش‌های دینامیک به جای Hard-code:** نقش‌ها رو توی دیتابیس ذخیره کردیم (مدل Role) نه به صورت Enum یا Constant. این باعث شد مدیر سیستم بتونه نقش‌های جدید بسازه بدون تغییر کد.

**فیلد‌های ارتباطی متعدد روی Case:** هر پرونده فیلدهای جدا برای `assigned_cadet`، `assigned_officer`، `assigned_detective` و `assigned_sergeant` داره. این به جای یه رابطه M2M ساده انتخاب شد چون هر نقش مسئولیت متفاوتی داره و باید مشخص باشه چه کسی در چه مرحله‌ای مسئوله.

**سیستم سطح جرم ۴ درجه‌ای:** چهار سطح (بحرانی، عمده، متوسط، جزئی) تعریف شد که مستقیماً روی جریان کاری تأثیر می‌ذاره. مثلاً فقط جرایم بحرانی نیاز به تأیید رئیس پلیس دارن و فقط جرایم سطح ۲ و ۳ واجد شرایط وثیقه هستن.

---

## 3. معماری کلی سیستم

### 3.1 معماری بک‌اند

بک‌اند با **Django 4.2** و **Django REST Framework 3.14** نوشته شده و از ۵ اپلیکیشن مجزا تشکیل شده:

| اپلیکیشن        | مسئولیت                                                                   |
| --------------- | ------------------------------------------------------------------------- |
| `accounts`      | مدیریت کاربران، نقش‌ها، احراز هویت، پنل مدیریت                            |
| `cases`         | مدیریت پرونده‌ها، شاکیان، شاهدان، سطح جرم، بررسی پرونده                   |
| `evidence`      | مدیریت مدارک (شهادت، بیولوژیک، خودرو، مستندات هویتی، عمومی)               |
| `investigation` | تخته کارآگاهی، مظنونین، بازجویی، تصمیم‌ کاپیتان/رئیس، خبرچینی، نوتیفیکیشن |
| `trial`         | محاکمه، رأی، مجازات، وثیقه و پرداخت                                       |

ساختار URL ها:

```

/api/v1/accounts/ → مدیریت کاربران و نقش‌ها

/api/v1/cases/ → پرونده‌ها و بررسی‌ها

/api/v1/evidence/ → مدارک

/api/v1/investigation/→ تحقیقات و بازجویی

/api/v1/trial/ → محاکمه و وثیقه

/api/docs/ → مستندات Swagger

/api/redoc/ → مستندات ReDoc

```

**دیتابیس:** PostgreSQL 16 در داکر

**مستندسازی API:** با استفاده از `drf-spectacular` مستندات OpenAPI به صورت خودکار تولید می‌شه و از طریق Swagger UI و ReDoc قابل دسترسیه.

### 3.2 معماری فرانت‌اند

فرانت‌اند با **React 18.3** و **TypeScript 5.5** با بیلدتول **Vite 5.3** ساخته شده.

ساختار پوشه‌ها:

```

src/

├── components/ → کامپوننت‌های مشترک (Header, Footer, CaseCard, ...)

├── contexts/ → AuthContext, NotificationContext

├── pages/ → تمام صفحات (حدود ۲۵ صفحه)

│ └── admin/ → صفحات مدیریت (Dashboard, Users, Roles, Cases)

├── services/ → ماژول‌های API (auth, case, evidence, investigation, trial, admin)

├── styles/ → فایل‌های CSS

└── utils/ → ابزارهای کمکی (errorHandler)

```

**مدیریت State:** از Redux یا Zustand استفاده نشده. فقط React Context برای Auth و Notification استفاده شده و بقیه state ها محلی هستن (`useState`/`useEffect`). این تصمیم قابل دفاعه چون اکثر state ها صفحه‌محور هستن و نیاز به global store پیچیده نبود.

**ارتباط با API:** از طریق Axios با `baseURL: /api/v1` و `withCredentials: true`. یک interceptor توکن CSRF رو از cookie می‌خونه و به header اضافه می‌کنه.

**استایل:** CSS خالص بدون فریمورک، با متغیرهای CSS و تم Film Noir (رنگ‌های مشکی، طلایی، زرشکی). فونت‌های Playfair Display و Special Elite برای حس رترو.

---
