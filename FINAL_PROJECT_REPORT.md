# گزارش نهایی پروژه — سیستم مدیریت جرم LA Noire NextGen

---

## فهرست مطالب

1. [مقدمه و معرفی کلی سیستم](#1-مقدمه-و-معرفی-کلی-سیستم)

2. [تحلیل نیازمندی‌ها و تصمیمات طراحی](#2-تحلیل-نیازمندیها-و-تصمیمات-طراحی)

3. [معماری کلی سیستم](#3-معماری-کلی-سیستم)

4. [موجودیت‌ها و دلیل وجودشان](#4-موجودیتها-و-دلیل-وجودشان)

5. [پیاده‌سازی جریان‌های کاری](#5-پیادهسازی-جریانهای-کاری)

6. [کنترل دسترسی و مدیریت نقش‌ها](#6-کنترل-دسترسی-و-مدیریت-نقشها)

7. [طراحی API و اصول REST](#7-طراحی-api-و-اصول-rest)

8. [ساختار فرانت‌اند و صفحات اصلی](#8-ساختار-فرانتاند-و-صفحات-اصلی)

9. [داکرایز و ساختار استقرار](#9-داکرایز-و-ساختار-استقرار)

10. [تست‌نویسی](#10-تستنویسی)

11. [نقاط قوت و ضعف تصمیمات](#11-نقاط-قوت-و-ضعف-تصمیمات)

12. [استفاده از هوش مصنوعی](#12-استفاده-از-هوش-مصنوعی)

13. [مدیریت پروژه و تقسیم کار](#13-مدیریت-پروژه-و-تقسیم-کار)

---

## 1. مقدمه و معرفی کلی سیستم

پروژه LA Noire NextGen یک سیستم وب‌محور مدیریت پرونده‌های جنایی است که با الهام از بازی LA Noire طراحی شده. این سیستم تمام مراحل یک پرونده جنایی رو از ثبت شکایت اولیه تا صدور حکم دادگاه پوشش می‌ده و برای نقش‌های مختلفی مثل شهروندان، کارآگاهان، افسران، قاضی و مدیر سیستم طراحی شده.

هدف اصلی پروژه شبیه‌سازی یک سیستم واقعی مدیریت جرم و جنایت بود که در اون:

- شهروندان بتونن شکایت ثبت کنن یا اطلاعات جرم ارسال کنن

- افسران پرونده‌ها رو بررسی و باز کنن

- کارآگاهان تحقیق کنن، مدارک جمع کنن و مظنون‌ها رو شناسایی کنن

- بازجویی انجام بشه و تصمیم‌گیری بشه

- محاکمه و صدور حکم انجام بشه

- سیستم پاداش و وثیقه با درگاه پرداخت واقعی (زرین‌پال) کار کنه

تکنولوژی‌های اصلی:

- **بک‌اند**: Django 4.2 + Django REST Framework + PostgreSQL

- **فرانت‌اند**: React 18 + TypeScript + Vite

- **استقرار**: Docker Compose (سه سرویس: db, backend, frontend)

- **پرداخت**: درگاه زرین‌پال (حالت Sandbox)

---

## 2. تحلیل نیازمندی‌ها و تصمیمات طراحی

### 2.1 نیازمندی‌های اولیه

وقتی پروژه شروع شد، نیازمندی‌های اصلی اینا بودن:

- سیستم ثبت و مدیریت پرونده‌های جنایی

- سیستم مدیریت مدارک

- سیستم نقش‌محور با سلسله‌مراتب پلیسی

- جریان کاری از ثبت شکایت تا بسته شدن پرونده

- پنل مدیریت

### 2.2 نیازمندی‌هایی که بعداً اضافه شدن

در طول توسعه، ماژول‌های زیر هم به پروژه اضافه شدن:

- **تخته کارآگاهی** (Detective Board): یه بوم بصری برای کارآگاه که مدارک رو روش بذاره و بینشون خط قرمز بکشه

- **سیستم بازجویی**: با امتیازدهی ۱ تا ۱۰ توسط کارآگاه و گروهبان

- **سیستم تصمیم‌گیری چندسطحی**: کاپیتان → رئیس پلیس (برای جرایم حیاتی)

- **سیستم محاکمه**: ایجاد دادگاه، رأی قاضی، صدور مجازات

- **سیستم وثیقه با پرداخت زرین‌پال**: پرداخت آنلاین وثیقه و آزادی مظنون

- **سیستم پاداش و خبرچینی** (TipOff): شهروندان اطلاعات ارسال می‌کنن، بررسی می‌شه، کد پاداش صادر می‌شه

- **لیست تحت تعقیب عمومی** (Most Wanted): مظنونین بالای ۳۰ روز با امتیاز خطر

- **سیستم نوتیفیکیشن**: اعلان‌های درون‌برنامه‌ای برای تغییرات پرونده

### 2.3 تصمیمات طراحی مهم

**Session-based Authentication به جای JWT:** از احراز هویت مبتنی بر Session و Cookie استفاده کردیم. دلیلش این بود که فرانت‌اند و بک‌اند روی یک دامنه سرو می‌شن (از طریق nginx proxy) و نیازی به JWT نبود. این کار هم ساده‌تره و هم امنیت CSRF رو راحت‌تر مدیریت می‌کنه.

**نقش‌های دینامیک به جای Hard-code:** نقش‌ها رو توی دیتابیس ذخیره کردیم (مدل Role) نه به صورت Enum یا Constant. این باعث شد مدیر سیستم بتونه نقش‌های جدید بسازه بدون تغییر کد.

**فیلد‌های ارتباطی متعدد روی Case:** هر پرونده فیلدهای جدا برای `assigned_cadet`، `assigned_officer`، `assigned_detective` و `assigned_sergeant` داره. این به جای یه رابطه M2M ساده انتخاب شد چون هر نقش مسئولیت متفاوتی داره و باید مشخص باشه چه کسی در چه مرحله‌ای مسئوله.

**سیستم سطح جرم ۴ درجه‌ای:** چهار سطح (بحرانی، عمده، متوسط، جزئی) تعریف شد که مستقیماً روی جریان کاری تأثیر می‌ذاره. مثلاً فقط جرایم بحرانی نیاز به تأیید رئیس پلیس دارن و فقط جرایم سطح ۲ و ۳ واجد شرایط وثیقه هستن.

---

## 3. معماری کلی سیستم

### 3.1 معماری بک‌اند

بک‌اند با **Django 4.2** و **Django REST Framework 3.14** نوشته شده و از ۵ اپلیکیشن مجزا تشکیل شده:

| اپلیکیشن        | مسئولیت                                                                   |
| --------------- | ------------------------------------------------------------------------- |
| `accounts`      | مدیریت کاربران، نقش‌ها، احراز هویت، پنل مدیریت                            |
| `cases`         | مدیریت پرونده‌ها، شاکیان، شاهدان، سطح جرم، بررسی پرونده                   |
| `evidence`      | مدیریت مدارک (شهادت، بیولوژیک، خودرو، مستندات هویتی، عمومی)               |
| `investigation` | تخته کارآگاهی، مظنونین، بازجویی، تصمیم‌ کاپیتان/رئیس، خبرچینی، نوتیفیکیشن |
| `trial`         | محاکمه، رأی، مجازات، وثیقه و پرداخت                                       |

ساختار URL ها:

```

/api/v1/accounts/ → مدیریت کاربران و نقش‌ها

/api/v1/cases/ → پرونده‌ها و بررسی‌ها

/api/v1/evidence/ → مدارک

/api/v1/investigation/→ تحقیقات و بازجویی

/api/v1/trial/ → محاکمه و وثیقه

/api/docs/ → مستندات Swagger

/api/redoc/ → مستندات ReDoc

```

**دیتابیس:** PostgreSQL 16 در داکر

**مستندسازی API:** با استفاده از `drf-spectacular` مستندات OpenAPI به صورت خودکار تولید می‌شه و از طریق Swagger UI و ReDoc قابل دسترسیه.

### 3.2 معماری فرانت‌اند

فرانت‌اند با **React 18.3** و **TypeScript 5.5** با بیلدتول **Vite 5.3** ساخته شده.

ساختار پوشه‌ها:

```

src/

├── components/ → کامپوننت‌های مشترک (Header, Footer, CaseCard, ...)

├── contexts/ → AuthContext, NotificationContext

├── pages/ → تمام صفحات (حدود ۲۵ صفحه)

│ └── admin/ → صفحات مدیریت (Dashboard, Users, Roles, Cases)

├── services/ → ماژول‌های API (auth, case, evidence, investigation, trial, admin)

├── styles/ → فایل‌های CSS

└── utils/ → ابزارهای کمکی (errorHandler)

```

**مدیریت State:** از Redux یا Zustand استفاده نشده. فقط React Context برای Auth و Notification استفاده شده و بقیه state ها محلی هستن (`useState`/`useEffect`). این تصمیم قابل دفاعه چون اکثر state ها صفحه‌محور هستن و نیاز به global store پیچیده نبود.

**ارتباط با API:** از طریق Axios با `baseURL: /api/v1` و `withCredentials: true`. یک interceptor توکن CSRF رو از cookie می‌خونه و به header اضافه می‌کنه.

**استایل:** CSS خالص بدون فریمورک، با متغیرهای CSS و تم Film Noir (رنگ‌های مشکی، طلایی، زرشکی). فونت‌های Playfair Display و Special Elite برای حس رترو.

---

## 4. موجودیت‌ها و دلیل وجودشان

  

در کل **۲۷ مدل** در بک‌اند تعریف شده. دلیل وجود هر کدوم:

  

### اپلیکیشن accounts (۲ مدل)

  

| مدل      | دلیل وجود                                                                                                                                                                                                                       |
| -------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Role** | نقش‌ها باید دینامیک باشن و مدیر بتونه نقش جدید بسازه. هر نقش یه سطح سلسله‌مراتب (`hierarchy_level`) داره که مشخص می‌کنه چه سطحی از دسترسی باید داشته باشه. فیلد `is_police_rank` تشخیص می‌ده نقش پلیسیه یا غیرپلیسی.            |
| **User** | مدل کاربر سفارشی که `AbstractBaseUser` رو extend می‌کنه. علاوه بر فیلدهای معمول، `national_id` و `phone_number` هم داره چون توی سیستم قضایی شناسایی هویت مهمه. رابطه M2M با Role داره یعنی هر کاربر می‌تونه چند نقش داشته باشه. |

  

### اپلیکیشن cases (۵ مدل)

  

| مدل             | دلیل وجود                                                                                                                                                                                                                |
| --------------- | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| **CrimeLevel**  | سطح جرم مستقیماً روی جریان کار تأثیر می‌ذاره (وثیقه فقط برای سطح ۲ و ۳، جرایم بحرانی نیاز به تأیید رئیس پلیس). تعریفش به صورت جدای از Case انعطاف بیشتری می‌ده.                                                          |
| **Case**        | هسته اصلی سیستم. هر پرونده ۱۱ وضعیت مختلف داره و با `status` مشخصه کجای جریان کاره. فیلدهای متعدد assign شده نشون می‌ده هر مرحله مسئولیت کیه. `formation_type` مشخص می‌کنه آیا پرونده از شکایت ساخته شده یا از صحنه جرم. |
| **Complainant** | یک پرونده می‌تونه چند شاکی داشته باشه. این مدل واسطه رابطه Case و User هست و `statement` هر شاکی رو جدا ذخیره می‌کنه. فیلد `verified_by_cadet` مشخص می‌کنه آیا هویت شاکی تأیید شده.                                      |
| **Witness**     | شاهدان لزوماً کاربر ثبت‌شده نیستن، پس فیلدهای `full_name`، `phone_number` و `national_id` رو مستقیم ذخیره می‌کنه. اگه شاهد کاربر ثبت‌شده باشه FK به User داره.                                                           |
| **CaseReview**  | تاریخچه بررسی‌ها. هر بار که کادت یا افسر پرونده رو تأیید یا رد می‌کنه یه رکورد ثبت می‌شه. این برای شفافیت و قابلیت پیگیریه.                                                                                              |
  

### اپلیکیشن evidence (۶ مدل)

  

| مدل                    | دلیل وجود                                                                                                                                  |
| ---------------------- | ------------------------------------------------------------------------------------------------------------------------------------------ |
| **Testimony**          | شهادت شاهدان با متن، تصویر، صوت و ویدئو. از BaseEvidence ارث‌بری می‌کنه.                                                                   |
| **BiologicalEvidence** | مدارک بیولوژیک (خون، مو، اثرانگشت) که نیاز به تأیید پزشک قانونی دارن. فیلد `verified_by_coroner` با timestamp مشخص می‌کنه تأیید شده یا نه. |
| **EvidenceImage**      | تصاویر مربوط به مدارک بیولوژیک. جدا شده چون هر مدرک ممکنه چند تصویر داشته باشه (رابطه M2M).                                                |
| **VehicleEvidence**    | مدارک مربوط به خودرو. یه validation جالب داره: یا باید `license_plate` داشته باشه یا `serial_number`، نه هر دو.                            |
| **IDDocument**         | مدارک هویتی با فیلد `attributes` از نوع JSON. این طراحی انعطاف‌پذیره چون هر نوع مدرک هویتی فیلدهای متفاوتی داره.                           |
| **GenericEvidence**    | برای هر مدرکی که توی دسته‌بندی‌های بالا نمی‌شینه. یه fallback خوب برای جامع بودن سیستم.                                                    |

### اپلیکیشن investigation (۱۰ مدل)

  

| مدل                     | دلیل وجود                                                                                                                                                                   |
| ----------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **DetectiveBoard**      | تخته تحقیقاتی کارآگاه. رابطه OneToOne با Case. هر کارآگاه یه تخته بصری برای قرار دادن مدارک و کشیدن ارتباط بینشون داره.                                                     |
| **BoardItem**           | آیتم‌های روی تخته. `position_x`/`position_y` برای نمایش بصری و `content_type`/`object_id` برای لینک به مدارک واقعی.                                                         |
| **EvidenceConnection**  | خطوط قرمز بین آیتم‌ها روی تخته. مدل کردنش به صورت جدا از BoardItem باعث شده بشه ارتباطات رو مستقل مدیریت کرد.                                                               |
| **Suspect**             | مظنون یه پرونده. وضعیت‌های مختلف (تحت تعقیب، تعقیب شدید، دستگیر، تبرئه) داره. متدهای `get_danger_score()` و `get_reward_amount()` بر اساس مدت تعقیب و سطح جرم محاسبه می‌شن. |
| **Interrogation**       | بازجویی مظنون توسط کارآگاه و گروهبان. هر دو امتیاز گناه (۱ تا ۱۰) و یادداشت‌شون رو ثبت می‌کنن.                                                                              |
| **CaptainDecision**     | تصمیم کاپیتان بعد از بازجویی (مجرم/بی‌گناه/نیاز به تحقیق بیشتر). جرایم بحرانی نیاز به تأیید رئیس پلیس هم دارن.                                                              |
| **PoliceChiefDecision** | تأیید یا رد تصمیم کاپیتان توسط رئیس پلیس. فقط برای جرایم بحرانی الزامیه.                                                                                                    |
| **TipOff**              | خبرچینی شهروندان. جریان ۶ مرحله‌ای داره: ثبت → بررسی افسر → بررسی کارآگاه → صدور کد پاداش → بازخرید.                                                                        |
| **SuspectSubmission**   | پیشنهاد رسمی مظنونین توسط کارآگاه به گروهبان. اگه تأیید بشه حکم جلب صادر و وضعیت پرونده تغییر می‌کنه.                                                                       |
| **Notification**        | اعلان‌های سیستمی (مدرک جدید، تغییر وضعیت پرونده، پاداش و ...). ۹ نوع مختلف داره و به هر کاربر ارسال می‌شه.                                                                  |

### اپلیکیشن trial (۴ مدل)

  

| مدل             | دلیل وجود                                                                                                                              |
| --------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| **Trial**       | محاکمه مظنون. شامل ارجاع از کاپیتان/رئیس و انتخاب قاضی. متد `get_involved_police_members()` تمام پرسنل درگیر در پرونده رو برمی‌گردونه. |
| **Verdict**     | حکم قاضی (مجرم/بی‌گناه) با استدلال. OneToOne با Trial.                                                                                 |
| **Punishment**  | مجازات (فقط در صورت مجرمیت). عنوان و شرح مجازات.                                                                                       |
| **BailPayment** | وثیقه با مبلغ ریالی. وضعیت‌ها: pending → approved → paid. اتصال به درگاه زرین‌پال برای پرداخت آنلاین.                                  |

  

---

  

## 5. پیاده‌سازی جریان‌های کاری

  

### 5.1 ثبت‌نام و ورود

  

ثبت‌نام از طریق endpoint عمومی `POST /api/v1/accounts/users/` انجام می‌شه. سریالایزر `UserRegistrationSerializer` فیلدهای username، email، phone_number، national_id، password و password_confirm رو اعتبارسنجی می‌کنه و نقش "Base User" رو خودکار اختصاص می‌ده.

  

ورود با `POST /api/v1/accounts/login/` و ارسال username و password انجام می‌شه. بعد از تأیید، یک session ساخته می‌شه و cookie با نام `sessionid` ست می‌شه. فرانت‌اند از `getCurrentUser()` برای چک کردن وضعیت لاگین استفاده می‌کنه.

  

### 5.2 ایجاد پرونده

  

دو مسیر برای ایجاد پرونده وجود داره:

  

**مسیر شکایت:** شهروند شکایت ثبت می‌کنه → شماره پرونده خودکار تولید می‌شه (مثلاً `2026-CMPL-0001`) → وضعیت: `draft` → ارسال برای بررسی کادت (`cadet_review`)

  

**مسیر صحنه جرم:** افسر گزارش صحنه جرم ثبت می‌کنه → شماره: `2026-SCEN-0001` → مستقیماً به بررسی افسر (`officer_review`) می‌ره → رئیس پلیس تأیید خودکار → باز (`open`)

  

### 5.3 بررسی و باز شدن پرونده

  

```

draft → cadet_review → officer_review → open

↓ (رد) ↓ (رد)

draft (تا ۳ بار) cadet_review (شکایت)

draft (صحنه جرم)

↓ (۳ بار رد)

rejected (نهایی)

```

  

کادت پرونده رو بررسی می‌کنه، هویت شاکی رو تأیید می‌کنه و تأیید یا رد صادر می‌کنه. اگه تأیید بشه به بررسی افسر می‌ره. افسر هم تأیید یا رد می‌کنه. بعد از ۳ بار رد، پرونده برای همیشه رد می‌شه.

  

### 5.4 ثبت و مدیریت مدارک

  

بعد از باز شدن پرونده، مدارک قابل ثبتن. ۵ نوع مدرک:

  

1. **شهادت** (Testimony): متن + تصویر + صوت + ویدئو

2. **بیولوژیک** (BiologicalEvidence): خون، مو، اثرانگشت. نیاز به تأیید پزشک قانونی (Coroner)

3. **خودرو** (VehicleEvidence): مدل، رنگ، پلاک یا شماره شاسی

4. **مدارک هویتی** (IDDocument): با فیلد JSON انعطاف‌پذیر

5. **عمومی** (GenericEvidence): هر چیز دیگه

  

فقط مدارک مربوط به پرونده‌های با وضعیت `open` یا `under_investigation` قابل ثبتن.

  

### 5.5 تحقیق و شناسایی مظنون

  

وقتی کارآگاه به پرونده اختصاص داده بشه، وضعیتش می‌شه `under_investigation`. کارآگاه تخته تحقیقاتی می‌سازه و مدارک رو روش قرار می‌ده.

  

کارآگاه مظنون‌ها رو شناسایی و `SuspectSubmission` ایجاد می‌کنه. وضعیت پرونده می‌شه `suspects_identified`. گروهبان بررسی می‌کنه: اگه تأیید کنه، حکم جلب صادر و وضعیت می‌شه `arrest_approved`.

  

### 5.6 بازجویی

  

بعد از دستگیری، بازجویی ایجاد می‌شه. کارآگاه و گروهبان هر دو:

- امتیاز گناه (۱ تا ۱۰) ثبت می‌کنن

- یادداشت‌هاشون رو می‌نویسن

  

بعد از ثبت، بازجویی به کاپیتان ارسال می‌شه.

  

### 5.7 تصمیم‌گیری کاپیتان و رئیس پلیس

  

کاپیتان سه انتخاب داره:

- **مجرم** (guilty): ارسال به محاکمه

- **بی‌گناه** (not_guilty): آزادی مظنون

- **نیاز به تحقیق بیشتر** (needs_more): برگشت به تحقیقات

  

اگه سطح جرم **بحرانی** (Critical, level=0) باشه، تصمیم کاپیتان باید توسط رئیس پلیس هم تأیید بشه.

  

### 5.8 محاکمه و صدور حکم

  

Trial ساخته می‌شه و قاضی اختصاص داده می‌شه. قاضی از طریق endpoint `case_summary` می‌تونه تمام مدارک، پرسنل درگیر، بازجویی‌ها و تصمیمات رو ببینه.

  

قاضی حکم صادر می‌کنه:

- **مجرم**: Verdict + Punishment ساخته می‌شه

- **بی‌گناه**: فقط Verdict با reasoning

  

بعد از حکم، Trial کامل و پرونده بسته می‌شه.

  

### 5.9 وثیقه و پرداخت زرین‌پال

  

وثیقه فقط برای جرایم سطح ۲ و ۳ (متوسط و جزئی) قابل صدوره. مبلغ بین ۱ میلیون تا ۱۰ میلیارد ریال.

  

جریان:

1. پلیس درخواست وثیقه ثبت می‌کنه

2. سطح ۲: نیاز به تأیید گروهبان | سطح ۳: تأیید خودکار

3. کاربر دکمه پرداخت رو می‌زنه → درخواست به API زرین‌پال ارسال می‌شه → `authority` برمی‌گرده

4. کاربر به صفحه پرداخت زرین‌پال ری‌دایرکت می‌شه

5. بعد از پرداخت، برمی‌گرده به `/bail/return?bail_id=X&Authority=Y&Status=OK`

6. فرانت‌اند verify رو صدا می‌زنه → بک‌اند با API زرین‌پال تأیید می‌کنه

7. در صورت موفقیت: وثیقه `paid`، مظنون `cleared` (آزاد)

  

### 5.10 سیستم خبرچینی و پاداش (TipOff)

  

```

شهروند ثبت → pending

↓

افسر بررسی → officer_approved / officer_rejected

↓

کارآگاه بررسی → approved (کد پاداش صادر) / detective_rejected

↓

شهروند به کلانتری مراجعه → بررسی کد ملی + کد پاداش → redeemed

```

  

مبلغ پیش‌فرض پاداش ۵,۰۰۰,۰۰۰ ریال هست. کد پاداش به صورت `REWARD-XXXXXXXXXX` تولید می‌شه.

  

### 5.11 لیست تحت تعقیب شدید (Most Wanted)

  

مظنونینی که بیش از ۳۰ روز تحت تعقیب هستن، خودکار به وضعیت `intensive_pursuit` ارتقا پیدا می‌کنن. امتیاز خطر:

  

```

danger_score = تعداد_روزهای_تعقیب × (4 - سطح_جرم)

reward_amount = danger_score × 20,000,000 ریال

```

  

این لیست **عمومی** هست و بدون احراز هویت قابل مشاهده‌ست.

  

---

  

## 6. کنترل دسترسی و مدیریت نقش‌ها

  

### 6.1 نقش‌ها و سلسله‌مراتب

  

سیستم ۱۷ نقش پیش‌فرض داره که در seed اولیه ساخته می‌شن:

  

| نقش            | سطح | پلیسی؟ | توانایی‌های کلیدی                                    |
| -------------- | --- | ------ | ---------------------------------------------------- |
| Base User      | 0   | خیر    | ثبت شکایت، مشاهده پرونده‌های خود، ارسال خبرچینی      |
| Complainant    | 0   | خیر    | شاکی پرونده                                          |
| Witness        | 0   | خیر    | شاهد                                                 |
| Suspect        | 0   | خیر    | مظنون                                                |
| Criminal       | 0   | خیر    | مجرم                                                 |
| Cadet          | 1   | بله    | بررسی اولیه پرونده، تأیید هویت شاکیان                |
| Patrol Officer | 2   | بله    | بررسی خبرچینی، گشت‌زنی                               |
| Police Officer | 3   | بله    | بررسی خبرچینی، بازبینی پرونده                        |
| Detective      | 4   | بله    | تحقیقات، تخته کارآگاهی، شناسایی مظنون، بررسی خبرچینی |
| Sergeant       | 5   | بله    | بررسی پیشنهاد مظنون، تأیید وثیقه، هم‌بازجو           |
| Lieutenant     | 6   | بله    | نظارت بر کارآگاهان                                   |
| Captain        | 7   | بله    | تصمیم‌گیری بازجویی، ایجاد محاکمه                     |
| Deputy Chief   | 8   | بله    | معاون رئیس                                           |
| Chief          | 9   | بله    | تأیید نهایی جرایم بحرانی                             |
| Judge          | 0   | خیر    | قضاوت، صدور حکم                                      |
| Coroner        | 0   | خیر    | تأیید مدارک بیولوژیک                                 |
| Administrator  | 10  | خیر    | دسترسی کامل سیستم                                    |

  

### 6.2 مکانیزم Permission

  

در بک‌اند، چند لایه کنترل دسترسی داریم:

  

1. **Permission Class سفارشی `IsAdminUser`**: چک می‌کنه کاربر `is_superuser`، `is_staff` یا نقش "Administrator" داره.

  

2. **چک نقش در ویوها**: اکثر اکشن‌های ویوست‌ها داخل خودشون چک می‌کنن کاربر نقش مناسب داره. مثلاً:

- `cadet_review` فقط برای کاربران با نقش Cadet

- `verify` مدارک بیولوژیک فقط برای Coroner

- `deliver_verdict` فقط برای Judge اختصاص‌داده‌شده

  

3. **فیلتر QuerySet بر اساس نقش**: متد `get_queryset` توی هر ViewSet پرونده‌ها/مدارک رو بر اساس نقش کاربر فیلتر می‌کنه. مثلاً کارآگاه فقط پرونده‌های اختصاص‌داده‌شده رو می‌بینه.

  

در فرانت‌اند، تابع `hasRole()` توی Header برای نمایش/مخفی‌کردن لینک‌های ناوبری استفاده می‌شه. صفحه AdminPanel هم چک `isAdmin()` داره.

  

---

  

## 7. طراحی API و اصول REST

  

### 7.1 ساختار RESTful

  

API ها از اصول REST پیروی می‌کنن:

  

- **Versioning:** همه endpoint ها زیر `/api/v1/` هستن

- **نام‌گذاری:** از plural nouns استفاده شده (`/cases/`, `/suspects/`, `/trials/`)

- **HTTP Methods:** `GET` برای خواندن, `POST` برای ایجاد, `PUT/PATCH` برای بروزرسانی, `DELETE` برای حذف

- **Status Codes:** استفاده صحیح از ۲۰۰، ۲۰۱، ۴۰۰، ۴۰۱، ۴۰۳، ۴۰۴

  

### 7.2 اکشن‌های سفارشی

  

ViewSet ها از `@action` decorator برای عملیات خاص استفاده کردن:

  

```python

# نمونه: اکشن بررسی کادت

@action(detail=True, methods=['post'], url_path='cadet-review')

def cadet_review(self, request, pk=None):

...

  

# نمونه: اکشن پرداخت وثیقه

@action(detail=True, methods=['post'])

def pay(self, request, pk=None):

...

```

  

### 7.3 فیلتر، جستجو و صفحه‌بندی

  

از `DjangoFilterBackend`، `SearchFilter` و `OrderingFilter` استفاده شده. صفحه‌بندی PageNumber با ۲۰ آیتم در هر صفحه.

  

### 7.4 مستندسازی خودکار

  

با `drf-spectacular` مستندات OpenAPI تولید می‌شه:

- Swagger UI در `/api/docs/`

- ReDoc در `/api/redoc/`

  

---

  

## 8. ساختار فرانت‌اند و صفحات اصلی

  

### 8.1 صفحات عمومی

  

| صفحه            | توضیح                                                  |
| --------------- | ------------------------------------------------------ |
| **Home**        | صفحه اصلی با آمار عمومی پرونده‌ها و دسترسی سریع        |
| **Login**       | فرم ورود با پشتیبانی از username، email، تلفن یا کدملی |
| **Register**    | ثبت‌نام با ۸ اعتبارسنجی مختلف                          |
| **MostWanted**  | لیست تحت تعقیب با امتیاز خطر و متر خطر بصری            |
| **PublicCases** | پرونده‌های صحنه جرم عمومی                              |

  

### 8.2 صفحات اصلی سیستم

  

| صفحه                   | توضیح                                                                                |
| ---------------------- | ------------------------------------------------------------------------------------ |
| **Dashboard**          | داشبورد ماژولار بر اساس نقش کاربر                                                    |
| **Cases**              | لیست پرونده‌ها با فیلتر وضعیت و جستجو                                                |
| **CaseDetail**         | جزئیات کامل پرونده شامل شاکیان، شاهدان، بررسی‌ها                                     |
| **CaseReview**         | صفحه بررسی برای کادت و افسر                                                          |
| **CreateComplaint**    | فرم ثبت شکایت با امکان اضافه کردن هم‌شاکیان                                          |
| **CreateCrimeScene**   | فرم ثبت گزارش صحنه جرم با اطلاعات شاهدان                                             |
| **Evidence**           | لیست مدارک با فیلتر نوع                                                              |
| **EvidenceRegister**   | فرم ثبت مدرک با فیلدهای داینامیک بر اساس نوع                                         |
| **DetectiveBoard**     | تخته تحقیقاتی بصری با Canvas. آیتم‌ها قابل drag هستن و خطوط قرمز بینشون کشیده می‌شه. |
| **Suspects**           | لیست و مدیریت مظنونین                                                                |
| **SuspectSubmissions** | پیشنهاد مظنون توسط کارآگاه و بررسی گروهبان                                           |
| **Interrogations**     | مدیریت بازجویی‌ها با امتیازدهی                                                       |
| **Trials**             | لیست محاکمات و صدور حکم                                                              |
| **BailPayments**       | مدیریت وثیقه و پرداخت آنلاین                                                         |
| **PaymentReturn**      | صفحه بازگشت از درگاه زرین‌پال                                                        |
| **Reports**            | گزارشات سیستم                                                                        |
| **TipReview**          | بررسی خبرچینی‌ها                                                                     |

  

### 8.3 پنل مدیریت

  

پنل ادمین از ۴ تب تشکیل شده:

1. **AdminDashboard**: کارت‌های آماری (تعداد کاربران، نقش‌ها، پرونده‌ها، مدارک، مظنونین، محاکمات)

2. **AdminUsers**: جدول کاربران با جستجو، صفحه‌بندی، ساخت کاربر، اختصاص نقش، فعال/غیرفعال‌کردن

3. **AdminRoles**: مدیریت نقش‌ها با سطح سلسله‌مراتب

4. **AdminCases**: مدیریت پرونده‌ها از دید مدیر

  

### 8.4 کامپوننت‌های مشترک

  

- **Header**: نوار ناوبری ثابت با آرم LAPD، منوهای کشویی بر اساس نقش، زنگ نوتیفیکیشن

- **Footer**: فوتر با برندینگ LAPD

- **CaseCard/CaseStatusBadge/CrimeLevelBadge**: نمایش کارت پرونده با بج‌های رنگی

- **NotificationBell**: زنگ اعلان با poll هر ۳۰ ثانیه

- **LoadingSkeleton**: ۴ نوع skeleton برای حالت بارگذاری

- **Pagination**: صفحه‌بندی ساده

  

### 8.5 سیستم طراحی بصری

  

تم بصری Film Noir:

- **رنگ‌ها**: Noir Black (#0a0a0a), Charcoal (#1a1a1a), Gold (#d4af37), Brass (#b5a642), Crimson (#8b1a1a), Evidence Blue (#1a4d7a)

- **فونت‌ها**: Playfair Display (تیترها)، Crimson Text (متن)، Special Elite (ماشین‌تحریری)

- **الگوها**: حاشیه طلایی بالای کارت‌ها، گرادیان‌های تیره، افکت hover با translateY، انیمیشن fadeIn

- **ریسپانسیو**: breakpoint در ۷۶۸ و ۱۰۲۴ پیکسل

  

---

  

## 9. داکرایز و ساختار استقرار

  

### 9.1 ساختار Docker Compose

  

سیستم از ۳ سرویس Docker تشکیل شده:

  

```yaml

services:

db: # PostgreSQL 16 Alpine

backend: # Django + Gunicorn

frontend: # React + Nginx

```

  

**سرویس db:**

- Image: `postgres:16-alpine`

- دیتابیس: `lanoire_db`

- Volume: `postgres_data` برای ماندگاری داده‌ها

- Healthcheck با `pg_isready`

  

**سرویس backend:**

- Dockerfile: `python:3.12-slim`

- نصب dependencies سیستمی (`libpq-dev`, `gcc`) برای `psycopg2`

- اجرا: `migrate → seed → gunicorn` با ۳ worker

- Environment variables برای SECRET_KEY، DEBUG، database

- Volume: `backend_media` برای فایل‌های آپلودی

- پورت: 8000

  

**سرویس frontend:**

- Multi-stage build: `node:20-alpine` برای build → `nginx:alpine` برای serve

- Nginx config: پروکسی `/api/` و `/static/` و `/media/` به backend

- SPA fallback: `try_files $uri $uri/ /index.html`

- پورت: 3000 (مپ به 80 داخلی)

  

### 9.2 اسکریپت Seed

  

اسکریپت `docker_seed.py` در اولین اجرا:

- ۱۷ نقش پیش‌فرض ایجاد می‌کنه

- ۴ سطح جرم ایجاد می‌کنه

- یک کاربر admin با دسترسی superuser می‌سازه

  

از `get_or_create` استفاده شده که اجرای مکرر مشکلی ایجاد نکنه (idempotent).

  

### 9.3 اسکریپت شروع محلی

  

`start.sh` یک اسکریپت Bash هست که:

- PostgreSQL محلی رو چک و در صورت نیاز استارت می‌کنه

- محیط مجازی Python رو فعال می‌کنه

- Migration اجرا می‌کنه

- بک‌اند و فرانت‌اند رو به صورت همزمان اجرا می‌کنه

  

---

## 10. تست‌نویسی

  

### 10.1 تست‌های بک‌اند

  

مجموعه تست بک‌اند شامل **۱۸ فایل تست** با بیش از **۹,۲۰۰ خط کد تست** هست.

  

**زیرساخت تست:**

- فریمورک: pytest + pytest-django

- فایل `base.py`: کلاس‌های `BaseTestCase` و `AuthenticatedAPITestCase` با helper های ساخت کاربر و لاگین

- فایل `conftest.py`: فیکسچرهای pytest برای `api_client`، `authenticated_client`، کاربران با نقش‌های مختلف

- فایل `factories.py`: Factory Boy با `RoleFactory` و `UserFactory`

- پیکربندی: `--no-migrations --reuse-db` برای سرعت

  

**پوشش تست‌ها:**

  

| فایل تست                  | تعداد خط | پوشش                                             |
| ------------------------- | -------- | ------------------------------------------------ |
| test_accounts             | 328      | ثبت‌نام، ورود/خروج، پروفایل، اختصاص نقش          |
| test_case_formation       | 871      | ایجاد پرونده (شکایت + صحنه جرم)، بررسی کادت/افسر |
| test_case_resolution      | 879      | پیشنهاد مظنون، تأیید گروهبان، تغییر وضعیت        |
| test_evidence             | 1079     | ۵ نوع مدرک، تأیید پزشک قانونی، بررسی دسترسی      |
| test_interrogation_system | 857      | جریان کامل بازجویی، تصمیم کاپیتان/رئیس           |
| test_reward_system        | 914      | جریان کامل خبرچینی → پاداش → بازخرید             |
| test_trial_system         | 623      | ایجاد محاکمه، خلاصه پرونده، حکم، وثیقه           |
| test_suspect_status       | 820      | ارتقای خودکار به تعقیب شدید، امتیاز خطر          |
| test_bugfix_patches       | 401      | تست‌های رگرسیون برای باگ‌فیکس‌ها                 |
| test_admin_panel          | 173      | endpoint آمار مدیریت                             |
| test_public_stats         | 124      | آمار عمومی                                       |
| stress_tests              | 198      | تست بار با Locust                                |

  

**نشانه‌گذاری تست‌ها:** مارکرهای `slow`، `integration`، `unit` و `stress` برای اجرای انتخابی.

  

### 10.2 تست‌های فرانت‌اند

  

فریمورک: **Vitest 1.6** + **@testing-library/react 16**

  

**۲۲ فایل تست** شامل:

  

| دسته        | تست‌ها                                                                                                      |
| ----------- | ----------------------------------------------------------------------------------------------------------- |
| سرویس‌ها    | api, auth, evidence, investigation, trial, admin — بررسی endpoint های صحیح و payload ها                     |
| کامپوننت‌ها | Header (نمایش منو بر اساس نقش)، Login (ارسال فرم و مدیریت خطا)                                              |
| صفحات       | Home, Evidence, MostWanted, Suspects, Trials, Reports, AdminPanel — رندر صفحه، fetch داده، فیلتر، حالت خالی |
| زیرساخت     | setup (mock ها)، utils (helper های تست)                                                                     |

  

**الگوی تست:** Mock کردن ماژول `api` با `vi.mock()`، بررسی فراخوانی endpoint ها، wrap کردن کامپوننت‌ها در `BrowserRouter + NotificationProvider`.

  

---

## 11. نقاط قوت و ضعف تصمیمات

  

### 11.1 نقاط قوت

  

1. **معماری ماژولار ۵ اپلیکیشن**: جداسازی خوبی بین بخش‌های مختلف سیستم انجام شده. هر اپلیکیشن مسئولیت مشخصی داره و می‌شه مستقل تست و توسعه‌شون داد.

  

2. **سیستم نقش دینامیک**: ذخیره نقش‌ها در دیتابیس به جای hard-code باعث انعطاف بیشتر شده. مدیر می‌تونه بدون تغییر کد نقش جدید بسازه.

  

3. **مدل Case با ۱۱ وضعیت**: جریان کاری واقع‌گرایانه‌ای ایجاد شده که مراحل واقعی یک پرونده جنایی رو شبیه‌سازی می‌کنه.

  

4. **تخته کارآگاهی بصری**: پیاده‌سازی Canvas برای drag and drop آیتم‌ها و کشیدن خطوط قرمز یه ویژگی خلاقانه و جذابه.

  

5. **پرداخت واقعی با زرین‌پال**: اتصال به درگاه واقعی (حتی در حالت Sandbox) نشون‌دهنده آمادگی برای محیط تولیده.

  

6. **تست‌نویسی جامع**: بیش از ۹۰۰۰ خط تست بک‌اند و ۲۲ فایل تست فرانت‌اند پوشش خوبی فراهم می‌کنه.

  

7. **مستندسازی خودکار API**: استفاده از drf-spectacular باعث می‌شه مستندات همیشه با کد هماهنگ باشه.

  

8. **Seed اسکریپت Idempotent**: استفاده از `get_or_create` باعث می‌شه اسکریپت seed بدون خطا چندبار قابل اجرا باشه.

  

### 11.2 نقاط ضعف

  

1. **فقدان WebSocket**: نوتیفیکیشن‌ها با poll هر ۳۰ ثانیه هست که بهینه نیست. استفاده از Django Channels و WebSocket بهتر بود.

  

2. **عدم استفاده از Global State Manager**: برای اپلیکیشنی به این حجم، نبود Zustand یا Redux ممکنه با رشد پروژه مشکل‌ساز بشه. فعلاً قابل دفاعه ولی مقیاس‌پذیر نیست.

  

3. **چک نقش در View ها به صورت رشته‌ای**: نقش‌ها با مقایسه رشته‌ای (مثلاً `name='Detective'`) چک می‌شن. اگه اسم نقشی تغییر کنه، باگ ایجاد می‌شه. بهتر بود از ثابت‌ها (Constants) یا Enum استفاده بشه.

  

4. **عدم استفاده از CSS Module یا Styled Components**: فایل‌های CSS جدا با class name های ساده ممکنه clash داشته باشن. CSS Modules یا Tailwind امن‌تر بود.

  

5. **عدم پیاده‌سازی CI/CD کامل**: هیچ فایل GitHub Actions یا GitLab CI وجود نداره. تست‌ها فقط به صورت دستی قابل اجرا هستن.

  

6. **محاسبه danger_score در سطح Python**: برای حجم بالای داده، بهتره این محاسبات در DB query (annotation) باشه نه در Python.

  

---

  
## 12. استفاده از هوش مصنوعی

  

### 12.1 استفاده از AI در بک‌اند

  

#### نقاط قوت

- **تولید سریع بویلرپلیت**: ساختار اولیه مدل‌ها، سریالایزرها و ویوست‌ها با کمک AI خیلی سریع‌تر تولید شد.

- **نوشتن تست‌های جامع**: AI توی تولید سناریوهای تست مختلف خیلی خوبه. حجم بالای تست‌ها (۹۲۰۰+ خط) بدون AI خیلی زمان‌بر بود.

- **حل مسائل پیچیده**: پیاده‌سازی جریان‌های چندمرحله‌ای با state machine مثل وضعیت‌های Case، الگوریتم danger_score و اتصال زرین‌پال با کمک AI سریع‌تر انجام شد.

- **مستندسازی**: کامنت‌ها و Docstring های تمیزی تولید شده.

  

#### نقاط ضعف

- **تکرار الگو**: بعضی ViewSet ها الگوی مشابهی دارن که AI تکرار کرده بدون اینکه بهینه‌سازی کنه (مثلاً می‌شد یه Mixin مشترک درست کرد).

- **چک نقش رشته‌ای**: AI از مقایسه رشته‌ای استفاده کرده (`name__in=['Detective', 'Sergeant']`) که Type-safe نیست.

- **خطاهای جزئی**: بعضی باگ‌ها وجود داشتن (مشهود از فایل‌های test_bugfix و session patches) که بعداً رفع شدن.

  

#### نمونه کد تولیدشده توسط AI

  

**محاسبه امتیاز خطر مظنون:**

```python

def get_danger_score(self):

"""

Calculate danger score: max(days_pursued) * max(crime_level).

Used for ranking on wanted list.

"""

days_pursued = (timezone.now() - self.identified_at).days

crime_level_value = self.case.crime_level.level

level_score = 4 - crime_level_value

return days_pursued * level_score

  

def get_reward_amount(self):

"""

Calculate reward: danger_score * 20,000,000 Rials.

"""

return self.get_danger_score() * 20_000_000

```

  

**اتصال به درگاه زرین‌پال:**

```python

payload = {

"merchant_id": django_settings.ZARINPAL_MERCHANT_ID,

"amount": int(bail.amount),

"callback_url": callback_url,

"description": f"Bail payment for suspect in case {bail.suspect.case.case_number}",

"metadata": {

"mobile": "09999813456",

"email": "alef@gmail.com",

"order_id": str(bail.id),

}

}

response = http_requests.post(

django_settings.ZARINPAL_REQUEST_URL,

json=payload,

headers={'accept': 'application/json', 'content-type': 'application/json'},

timeout=30

)

```

  

### 12.2 استفاده از AI در فرانت‌اند

  

#### نقاط قوت

- **تولید سریع صفحات**: حدود ۲۵ صفحه با فرم‌ها، جداول و فیلترها سریع تولید شدن.

- **CSS تم Film Noir**: طراحی بصری منسجم با ۵۸۴ خط CSS متغیر و ۳۵ فایل CSS.

- **پیاده‌سازی Canvas**: لاجیک پیچیده تخته کارآگاهی با drag, drop و رسم خطوط قرمز.

- **Error Handler جامع**: مدیریت خطاهای DRF با map فیلدها به برچسب‌های قابل فهم.

- **پیاده‌سازی CSRF**: استخراج توکن از cookie و تزریق به header.

  

#### نقاط ضعف

- **TypeScript ضعیف**: در خیلی جاها از `any` استفاده شده و type safety کامل نیست.

- **تکرار کد**: الگوهای مشابه (`useState` + `useEffect` + `try/catch`) در همه صفحات تکرار شده بدون abstraction.

- **عدم استفاده از Custom Hook**: می‌شد hook های سفارشی مثل `useFetch` یا `useApiCall` ساخت.

  

#### نمونه کد فرانت‌اند تولیدشده:

  

**رسم خطوط قرمز روی Canvas:**

```tsx

ctx.beginPath();

ctx.moveTo(fromItem.position_x + 60, fromItem.position_y + 30);

ctx.lineTo(toItem.position_x + 60, toItem.position_y + 30);

ctx.strokeStyle = '#8b1a1a';

ctx.lineWidth = 2;

ctx.setLineDash([6, 4]);

ctx.stroke();

  

// Draw small circles at endpoints

[fromItem, toItem].forEach((item) => {

ctx.beginPath();

ctx.arc(item.position_x + 60, item.position_y + 30, 4, 0, Math.PI * 2);

ctx.fillStyle = '#8b1a1a';

ctx.fill();

});

```

  

**مدیریت CSRF Token:**

```tsx

api.interceptors.request.use((config) => {

const csrfToken = document.cookie

.split('; ')

.find(row => row.startsWith('csrftoken='))

?.split('=')[1];

if (csrfToken) {

config.headers['X-CSRFToken'] = csrfToken;

}

return config;

});

```

  

---


## 13. مدیریت پروژه و تقسیم کار

  

### 13.1 اعضای تیم و مسئولیت‌ها

  

#### نازنین غفاری

- **مسئولیت اصلی**: فرانت‌اند و UI/UX

- طراحی و پیاده‌سازی سیستم طراحی بصری Film Noir (CSS Variables، فونت‌ها، رنگ‌ها)

- پیاده‌سازی صفحات اصلی: Home, Dashboard, Cases, CaseDetail, CreateComplaint, CreateCrimeScene

- پیاده‌سازی AuthContext و NotificationContext

- کامپوننت‌های مشترک: Header با منوهای نقش‌محور، Footer، CaseCard، بج‌ها

- صفحه تخته کارآگاهی (DetectiveBoard) با Canvas API

- تست‌نویسی فرانت‌اند: تست‌های صفحات و کامپوننت‌ها

- مستندات فرانت‌اند (DESIGN_SYSTEM.md, CASE_WORKFLOWS_UI.md)

  

#### سهیل محمدخانی

- **مسئولیت اصلی**: بک‌اند (مدل‌ها، ویوها، API)

- طراحی و پیاده‌سازی مدل‌های دیتابیس (۲۷ مدل در ۵ اپلیکیشن)

- پیاده‌سازی ViewSet ها و سریالایزرها

- سیستم احراز هویت Session-based

- جریان کاری پرونده (۱۱ وضعیت) و سیستم بررسی

- سیستم بازجویی و تصمیم‌گیری چندسطحی

- اتصال درگاه زرین‌پال

- سیستم نقش و سلسله‌مراتب پلیسی

- تست‌نویسی بک‌اند: تست‌های واحد و یکپارچگی

  

#### امیرحسین وحیدی‌تبار

- **مسئولیت اصلی**: داکرایز، تست و فرانت‌اند تکمیلی

- پیکربندی Docker Compose (سه سرویس: db, backend, frontend)

- نوشتن Dockerfile ها (backend: python-slim + gunicorn, frontend: multi-stage node + nginx)

- پیکربندی Nginx (پروکسی API، SPA fallback)

- اسکریپت seed برای داده اولیه

- صفحات فرانت‌اند: Evidence, EvidenceRegister, Suspects, MostWanted, Interrogations, Trials, BailPayments, PaymentReturn

- لایه سرویس‌های API فرانت‌اند (evidence.ts, investigation.ts, trial.ts)

- تست‌نویسی سرویس‌های فرانت‌اند

- اسکریپت‌های start.sh و docker-start.sh

- پنل مدیریت فرانت‌اند (AdminPanel، AdminUsers، AdminRoles، AdminCases)

  

### 13.2 روش مدیریت پروژه

  

تقسیم کار به صورت **ماژولار** انجام شد. هر نفر مسئولیت بخش مشخصی از پروژه رو داشت و رابط‌ها (API endpoints و data contracts) از قبل مشخص شده بودن.

  

### 13.3 قراردادهای توسعه

  

**نام‌گذاری:**

- مدل‌ها: PascalCase (مثلاً `BailPayment`, `DetectiveBoard`)

- فیلدها: snake_case (مثلاً `case_number`, `assigned_detective`)

- URL ها: kebab-case (مثلاً `/bail-payments/`, `/detective-boards/`)

- کامپوننت‌های React: PascalCase (مثلاً `CaseCard.tsx`, `NotificationBell.tsx`)

- فایل‌های CSS: هم‌نام کامپوننت (مثلاً `DetectiveBoard.css`)

- سرویس‌های API: camelCase (مثلاً `getCases()`, `initiateBailPayment()`)

  

**ساختار کد:**

- هر اپلیکیشن Django ساختار استاندارد: `models.py`, `views.py`, `serializers.py`, `urls.py`, `admin.py`

- هر صفحه React یک فایل `.tsx` و یک فایل `.css` مجزا

- سرویس‌های API در پوشه `services/` با یک `api.ts` مرکزی

  

### 13.4 پکیج‌های NPM استفاده‌شده در فرانت‌اند

  

| پکیج | نسخه | دلیل استفاده |
|---|---|---|
| **react** | 18.3.1 | فریمورک اصلی UI. انتخاب React به خاطر اکوسیستم گسترده و Component-based بودنشه. |
| **react-router-dom** | 6.26.0 | مسیریابی سمت کلاینت. بدون این پکیج SPA امکان‌پذیر نیست و باید هر صفحه‌ای reload کامل بشه. |
| **axios** | 1.7.2 | کلاینت HTTP. به خاطر interceptor ها (برای CSRF و ۴۰۱ redirect) و API تمیزترش نسبت به fetch انتخاب شد. |
| **vite** | 5.3.1 | بیلدتول. خیلی سریع‌تر از Webpack هست، HMR عالی داره و پیکربندی ساده‌تریه. Proxy dev server هم برای جلوگیری از CORS مشکل مفیده. |
| **vitest** | 1.6.0 | فریمورک تست. با Vite سازگاره و نیاز به پیکربندی Babel/Jest جداگانه نیست. API مشابه Jest داره. |
| **@testing-library/react** | 16.0.0 | ابزار تست کامپوننت. تست رو از دید کاربر می‌نویسه (query by text/role) نه از دید internal structure. |

  

---

  

## پیوست: خلاصه فنی

  

| معیار                    | مقدار                             |
| ------------------------ | --------------------------------- |
| زبان بک‌اند              | Python 3.12 + Django 4.2          |
| زبان فرانت‌اند           | TypeScript 5.5 + React 18.3       |
| دیتابیس                  | PostgreSQL 16                     |
| تعداد مدل‌ها             | ۲۷                                |
| تعداد اپلیکیشن Django    | ۵                                 |
| تعداد endpoint API       | ~۶۰+                              |
| تعداد صفحات فرانت‌اند    | ~۲۵                               |
| تعداد فایل تست بک‌اند    | ۱۸                                |
| خطوط تست بک‌اند          | ۹,۲۰۰+                            |
| تعداد فایل تست فرانت‌اند | ۲۲                                |
| سرویس‌های Docker         | ۳ (db, backend, frontend)         |
| درگاه پرداخت             | زرین‌پال (Sandbox)                |
| مستندسازی API            | drf-spectacular (Swagger + ReDoc) |
